# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# _______ _______ _     _ _     _
#    |    |  |  | |     |  \___/    @rstacruz's
#    |    |  |  | |_____| _/   \_   tmux configuration
#
# ━━ Tmux plugin manager ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ {{{

set -g @plugin 'tmux-plugins/tpm' # tmux plugin manager
set -g @plugin 'tmux-plugins/tmux-sensible' # default settings
set -g @plugin 'tmux-plugins/tmux-yank' # `y` in visual mode to copy to clipboard

# }}}
# ━━ Options ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ {{{

# set -g default-terminal "screen-256color" Use 256 color mode by default
setw -g mode-keys vi # Vi mode in status and copy mode
set -g base-index 1 # Start tab numbering at 1 instead of 0
set -g repeat-time 100
set -g escape-time 0 # Fix emacs/vim escape delay
setw -g monitor-activity on # Highlight tabs with activity
set -g visual-bell off # No bell
set -g visual-activity off
set -g clock-mode-style 12 # 12-hour clock mode (^B t)
setw -g main-pane-width 110 # For main-horizontal mode (^B M-4), the width of the main left pane
set -g mouse on # Mouse support
set -g renumber-windows on # Auto-compact the window numbers

# }}}
# ━━ Keys (non-default) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ {{{

# Session/window management.
# (these shortcuts line up nicely with the default ^B !)
bind "@" command-prompt -p "Send pane to window:" "join-pane -t '%%'"
bind "#" command-prompt -p "New session:" "new-session -s '%%'"
bind "*" confirm-before -p "Kill the session? (y/n)" "kill-session"

# Change these to not have default values
unbind-key ","  ; bind "," command-prompt "rename-window '%%'"
unbind-key "'"  ; bind "'" command-prompt "select-window -t '%%'"
unbind-key "\$" ; bind "\$" command-prompt "rename-session '%%'"
bind ^r command-prompt "rename-window '%%'"

# Vim-like splitting
bind -r ^s split-window -c '#{pane_current_path}'
bind -r ^v split-window -h -c '#{pane_current_path}'
bind s split-window -c '#{pane_current_path}'
bind v split-window -h -c '#{pane_current_path}'

# https://github.com/peikk0/tmux-cssh
bind-key = set-window-option synchronize-panes

# new window
bind c neww -c '#{pane_current_path}'
bind ^c neww -c '#{pane_current_path}'

# }}}
# ━━ Keys (convenience shortcuts) ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ {{{

# Make them repeatable
unbind-key "{" ; bind -r "{" swap-pane -U
unbind-key "}" ; bind -r "}" swap-pane -D

# Ctrl convenience, So no need to release Ctrl
bind -r ^o select-pane -t :.+
bind -r ^n next-window
bind -r ^p previous-window
bind -r ^w choose-window
bind -r "^[" swap-pane -U
bind -r "^]" swap-pane -D

# No confirmation for ^B x
unbind x; bind -r x kill-pane
bind -r ^x kill-pane

# For nested tmux sessions, `bg` is easy to hit on a Colemak mod DH layout
bind C-g send-prefix

# bind-key C-Tab next-window
# bind-key C-S-Tab previous-window
# bind-key C-PgDn next-window
# bind-key C-PgUp previous-window

# }}}
# ━━ F12 - passthru mode ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ {{{
# Thanks https://github.com/samoshkin/tmux-config/blob/master/tmux/tmux.conf#L363

bind -T root F12 \
  set prefix None \; \
  set key-table off \; \
  set status-right '(passthru mode - F12 to exit)' \; \
  setw -g window-status-format ' ' \; \
  setw -g window-status-current-format ' ' \; \
  refresh-client -S \;

bind -T off F12 \
  set -u prefix \; \
  set -u key-table \; \
  set -u status-right \; \
  source-file ~/.tmux.conf \; \
  refresh-client -S \;

# }}}
# ━━ Theme ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ {{{

# Lines between panes
set -g pane-border-style 'fg=colour8'
set -g pane-active-border-style 'fg=colour1'

# Status bar styles
set -g clock-mode-colour '#888888'
set -g status-style 'fg=colour8'
setw -g message-style 'fg=blue'
setw -g window-status-style 'fg=colour8'
setw -g window-status-current-style 'fg=colour2'
setw -g window-status-activity-style ''

# Status format
set -g status-right '╱  #[fg=colour1]#S '
# if-shell 'test -n "$SSH_TTY"' "set -g status-right '#[fg=blue]#S #[fg=555555] -  #[fg=green]#(hostname)'"
if-shell 'test -n "$SSH_TTY"' "set -g status-right '#[fg=blue]  #S #[fg=green]#(hostname)'"
set -g status-left ' '

# Tabs
setw -g window-status-separator ''
setw -g window-status-current-format '#[fg=colour8]╱#[fg=colour4] #W   '
setw -g window-status-format '#[fg=colour8]╱ #W   '

# setw -g window-status-current-format '#[fg=colour4] #[fg=colour2]#I#[fg=colour4]┄#W ' # with number
# setw -g window-status-format ' #[fg=colour2]#I#[fg=colour8]┄#W '

# Status line options
set -g status-position bottom
set -g status-justify right
set -g status-interval 10
set -g status-right-length 100
set -g status-left-length 100

# }}}
# ━━ End ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ {{{

if-shell 'test -e ~/.tmux/tmuxrc.local' 'source-file ~/.tmux/tmuxrc.local' # Local 
run '~/.tmux/plugins/tpm/tpm' # Tmux plugin manager

# vim:foldmethod=marker
# }}}
